<p align="center">

<img src="./images/microsoft-azure-logo.png" width="400" />
</p>

<h1>Network Security Groups (NSGs) and Inspecting Traffic Between Azure Virtual Machines</h1>
In this lab, we used Wireshark to observe network traffic between Azure virtual machines and validated how Network Security Groups affect connectivity. By generating ICMP, SSH, DHCP, DNS, and RDP traffic, we correlated system commands with their underlying network protocols and observed how NSG rules directly control packet flow. This lab demonstrates practical Azure networking, traffic inspection, and basic cloud security concepts. <br />




<h2>Environments and Technologies Used</h2>

<p align="left">
<img src="https://skillicons.dev/icons?i=azure,windows,powershell" /> <img src="https://img.icons8.com/?size=50&id=rOHcpTUtCTjr&format=png&color=000000" /></p>



- Platform: Microsoft Azure (Virtual Machines/Compute)
- Remote Access: Remote Desktop
- Tools: Various Command-Line Tools
- Various Network Protocols: (SSH, RDH, DNS, HTTP/S, ICMP)
- Wireshark: (Protocol Analyzer)
- Operating Systems: Windows 10/11
- Ubuntu Server 24.04



<img src="https://skillicons.dev/icons?i=windows,ubuntu,linux" />



<h3>High-Level Steps</h3>

<img src="images/WireShark Traffic.gif" width="400" alt="Wireshark Traffic" />

- Step 1. Azure Environment Setup
- Step 2. ICMP Traffic Inspection
- Step 3. NSG Rule Observation
- Step 4. SSH, DHCP, DNS & RDP Traffic Observation

> [!IMPORTANT]
> Each step includes written instructions followed by a corresponding screenshot.<br>Expand the **See screenshots** section to view the images.



<h4>Actions and Observations</h4>

<h5> AZURE SETUP</h5>
- **Objective:** Configure the Azure environment
by creating a resource group and virtual
machines.
- Instructions:
1. Create a Resource Group name "rd-ad-lab".
2. Create Windows VM:
 -Name: **vm-client-1**
 -Image: **Windows 10/11 version
 -Size: Select any with **2 VCPU's 16GB 
 RAM**.
 - Set password authentication and create 
 credentials.
 -Select the previously created VNet **vnet-ad-lab** 
 and the default subnet.
 -Review and create the VM.

 

<h5>2. TRAFFIC INSPECTION AND SET UP</h5>

RDP into our "vm-client-1" machine, download and install wireshark, keep only default settings as prompted in installation. Open Wireshark and select the active network interface (Ethernet). In the "Apply a display filter" field, type "icmp" and press Enter. Open PowerShell and Ping the private IP Address of "vm-linux". 
```powershell
ping <Linux Private IP>
```
Observe the traffic in Wireshark. We filtered by ICMP to isolate and observe the echo request and reply packets generated by the ping test.
- Objective: Inspect ICMP traffic using
  Wireshark.
- Instructions:
  1. RDP into **vm-client-1 and download/ install
     Wireshark.
  2. Open Wireshark and select the active network
   interface (Ethernet).
  3. Apply the display filter by typing **icmp**
     and hit Enter.
  4. Open PowerShell and excute:
     '''powershell
     ping <Linux Private IP>''''
  5. Observe the ICMP traffic in Wireshark, noting
   the echo request and reply packets.
  

<details><summary>See screenshots</summary>

<img src="images/Step 2a.png" width="60%">

</details> 

<p>Inspect the data packet in Wireshark, under Internet Control Message Protocal drop down, and Data drop down, select the Data.</p>



<details><summary>See screenshots</summary>

<img src="images/Step 2b.png" width="60%">
</details>

> [!NOTE]
> On the right, you can see the ICMP payload, which often contains a predictable ASCII test pattern (such as the alphabet) used by the ping utility for easy identification during packet inspection.


<h6>NETWORK SECURITY GROUP RULE AND TRAFFIC OBSERVATION</h6>
- Objective: Observe how NSG rules affect
ICMP traffic.
- Instructions:
1. In PowerShell, create a perpetual ping:
'''powershell
ping <Linux Private IP> -t
2. In the Azure portal, navigate to **vm-linux**,
select **Network Settings**, then **Network security group**.
3. Under **Inbound security rules**, click**'+
Add" ** and create a rule with:
- ** Destination port ranges:**
- **Protocol:** ICMPv4
- **Action:** Deny
- **Priority:** 290
- **Name:** BlockICMP
4. Observe the output in Wireshark and
PowerShell, noting the "no Response Found!"
messages.
5. Remove the rule to renable ICMP traffic and inspect the network again.

ping <Linux Private IP> -t
`

<details><summary>See screenshots</summary>

<img src="images/Step 3a.jpg" width="30%">
</details>


<p>Observe the terminal and Wireshark output. Notice the "No Response Found!" in Wireshark, and "Request timed out." message in PowerShell.</p>

<details><summary>See screenshots</summary>

<img src="images/Step 3b.png" width="60%">
</details>

<p>Re-enable ICMP Traffic by deleting the created rule in Azure, and insepect our network traffic in the terminal and Wireshark.</p>

<details><summary>See screenshots</summary>

<img src="images/Step 3c.png" width="60%">
</details>

Back to normal. In PowerShell, press 
 `ctrl+c` 
 to stop the continous ping.

<h7>SSH TRAFFIC OBSERVATION</h7>
- Objective: Analyze SSH traffic between the
  client and Linux VM.
  - Instructions:
  1. Clear the Wireshark filter and apply the filter
     for SSH by typing **ssh**
  2. Create an SSH session from PowerShell:
   '''powershell
    ssh <linux username>@<linux private IP>
  3. Follow the prompts to authenticate.
  4. Execute commands such as 'id', 'hostname', 'uname', and 'pwd' in PowerShell
     and observe the traffic in Wireshark.
  5. Exit the SSH session by typing **"exit"**


Back in our client VM "vm-client-1" in Wireshark, clear the filter and filter for SSH traffic, type "SSH" in the "Apply a display filter" field. Now lets create a SSH Session between the Client VM and Domain Controller VM. In PowerShell, type the following,
```powershell
ssh <linux username>@<linux private IP>
```
In the following prompt, type yes and press Enter.
Next, enter your Linux user password. Note: No characters will appear on the screen while you type, this is normal behavior for security reasons. Press Enter when finished.

Observe the traffic within Wireshark.

<details><summary>See screenshots</summary>

<img src="images/Step 4a.png" width="60%">
</details> 

<p>In PowerShell, enter Commands such as id, hostname, uname, and pwd, and observe Wireshark again.</p>

<details><summary>See screenshots</summary>

<img src="images/Step 4b.png" width="60%">
</details> 

<p>Exit SSH by typing "Exit" in PowerShell.</p>

<h8>DHCP TRAFFIC OBSERVATION</h8>
- Objective: Monitor DHCP Traffic.
- Instructions:
 1. In Wireshark, filter to DHCP traffic using:
    '''plaintext
    udp.port == 67 || udp.port == 68
2. In PowerShell, run:
 '''powershell
ipconfig /renew
'''
3. Observe the DHCP traffic in Wireshark.
<details><summary>See screenshots</summary>

<img src="images/Step 5.png" width="60%">
</details> 

<h9> DNS TRAFFIC OBSERVATION</h9>
- Objective: Inspect DNS traffic.
- Instructions:
  1. In Wireshark, filter for DNS traffic using:
     '''plaintext
     DNS or udp.port == 53 || tcp.port == 53
     2. In PowerShell, excute:
     '''powershell
nslookup google.com
```


<h10>RDP TRAFFIC OBSERVATION</h10>
- Objective:: Review RDP Traffic.
- Instructions:
1. In Wireshark, filter for RDP traffic using:
'''plaintext
tcp.port == 3389
2. Analyze the data stream from your Remote
Desktop Connection to the virtual machine.


<details><summary>See screenshots</summary>

<img src="images/Step 7.png" width="60%">
</details>
